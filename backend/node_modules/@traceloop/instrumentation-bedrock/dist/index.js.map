{"version":3,"file":"index.js","sources":["../../src/instrumentation.ts"],"sourcesContent":["/*\n * Copyright Traceloop\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  Span,\n  Attributes,\n  SpanKind,\n  SpanStatusCode,\n  context,\n  trace,\n} from \"@opentelemetry/api\";\nimport {\n  InstrumentationBase,\n  InstrumentationModuleDefinition,\n  InstrumentationNodeModuleDefinition,\n  safeExecuteInTheMiddle,\n} from \"@opentelemetry/instrumentation\";\nimport { BedrockInstrumentationConfig } from \"./types\";\nimport type * as bedrock from \"@aws-sdk/client-bedrock-runtime\";\nimport {\n  CONTEXT_KEY_ALLOW_TRACE_CONTENT,\n  LLMRequestTypeValues,\n  SpanAttributes,\n} from \"@traceloop/ai-semantic-conventions\";\nimport {\n  ATTR_GEN_AI_COMPLETION,\n  ATTR_GEN_AI_PROMPT,\n  ATTR_GEN_AI_REQUEST_MAX_TOKENS,\n  ATTR_GEN_AI_REQUEST_MODEL,\n  ATTR_GEN_AI_REQUEST_TEMPERATURE,\n  ATTR_GEN_AI_REQUEST_TOP_P,\n  ATTR_GEN_AI_RESPONSE_MODEL,\n  ATTR_GEN_AI_SYSTEM,\n  ATTR_GEN_AI_USAGE_COMPLETION_TOKENS,\n  ATTR_GEN_AI_USAGE_PROMPT_TOKENS,\n} from \"@opentelemetry/semantic-conventions/incubating\";\nimport { version } from \"../package.json\";\n\nexport class BedrockInstrumentation extends InstrumentationBase {\n  declare protected _config: BedrockInstrumentationConfig;\n\n  constructor(config: BedrockInstrumentationConfig = {}) {\n    super(\"@traceloop/instrumentation-bedrock\", version, config);\n  }\n\n  public override setConfig(config: BedrockInstrumentationConfig = {}) {\n    super.setConfig(config);\n  }\n\n  protected init(): InstrumentationModuleDefinition {\n    const module = new InstrumentationNodeModuleDefinition(\n      \"@aws-sdk/client-bedrock-runtime\",\n      [\">=3.499.0\"],\n      this.wrap.bind(this),\n      this.unwrap.bind(this),\n    );\n\n    return module;\n  }\n\n  public manuallyInstrument(module: typeof bedrock) {\n    this._diag.debug(`Patching @aws-sdk/client-bedrock-runtime manually`);\n\n    this._wrap(\n      module.BedrockRuntimeClient.prototype,\n      \"send\",\n      this.wrapperMethod(),\n    );\n  }\n\n  private wrap(module: typeof bedrock, moduleVersion?: string) {\n    this._diag.debug(\n      `Patching @aws-sdk/client-bedrock-runtime@${moduleVersion}`,\n    );\n\n    this._wrap(\n      module.BedrockRuntimeClient.prototype,\n      \"send\",\n      this.wrapperMethod(),\n    );\n\n    return module;\n  }\n\n  private unwrap(module: typeof bedrock, moduleVersion?: string) {\n    this._diag.debug(\n      `Unpatching @aws-sdk/client-bedrock-runtime@${moduleVersion}`,\n    );\n\n    this._unwrap(module.BedrockRuntimeClient.prototype, \"send\");\n  }\n\n  private wrapperMethod() {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const plugin = this;\n    // eslint-disable-next-line\n    return (original: Function) => {\n      return function method(this: any, ...args: any) {\n        const span = plugin._startSpan({\n          params: args[0],\n        });\n        const execContext = trace.setSpan(context.active(), span);\n        const execPromise = safeExecuteInTheMiddle(\n          () => {\n            return context.with(execContext, () => {\n              return original.apply(this, args);\n            });\n          },\n          (e) => {\n            if (e) {\n              plugin._diag.error(`Error in bedrock instrumentation`, e);\n            }\n          },\n        );\n        const wrappedPromise = plugin._wrapPromise(span, execPromise);\n        return context.bind(execContext, wrappedPromise);\n      };\n    };\n  }\n  private _wrapPromise<T>(span: Span, promise: Promise<T>): Promise<T> {\n    return promise\n      .then(async (result) => {\n        await this._endSpan({\n          span,\n          result: result as\n            | bedrock.InvokeModelCommandOutput\n            | bedrock.InvokeModelWithResponseStreamCommandOutput,\n        });\n\n        return new Promise<T>((resolve) => resolve(result));\n      })\n      .catch((error: Error) => {\n        return new Promise<T>((_, reject) => {\n          span.setStatus({\n            code: SpanStatusCode.ERROR,\n            message: error.message,\n          });\n          span.recordException(error);\n          span.end();\n\n          reject(error);\n        });\n      });\n  }\n\n  private _startSpan({\n    params,\n  }: {\n    params: Parameters<bedrock.BedrockRuntimeClient[\"send\"]>[0];\n  }): Span {\n    let attributes: Attributes = {};\n\n    try {\n      const input = params.input as bedrock.InvokeModelCommandInput;\n      const { modelVendor, model } = this._extractVendorAndModel(\n        input.modelId || \"\",\n      );\n\n      attributes = {\n        [ATTR_GEN_AI_SYSTEM]: \"AWS\",\n        [ATTR_GEN_AI_REQUEST_MODEL]: model,\n        [ATTR_GEN_AI_RESPONSE_MODEL]: input.modelId,\n        [SpanAttributes.LLM_REQUEST_TYPE]: LLMRequestTypeValues.COMPLETION,\n      };\n\n      if (typeof input.body === \"string\") {\n        const requestBody = JSON.parse(input.body);\n\n        attributes = {\n          ...attributes,\n          ...this._setRequestAttributes(modelVendor, requestBody),\n        };\n      }\n    } catch (e) {\n      this._diag.debug(e);\n      this._config.exceptionLogger?.(e);\n    }\n\n    return this.tracer.startSpan(`bedrock.completion`, {\n      kind: SpanKind.CLIENT,\n      attributes,\n    });\n  }\n\n  private async _endSpan({\n    span,\n    result,\n  }: {\n    span: Span;\n    result:\n      | bedrock.InvokeModelCommandOutput\n      | bedrock.InvokeModelWithResponseStreamCommandOutput;\n  }) {\n    try {\n      if (\"body\" in result) {\n        const attributes =\n          \"attributes\" in span\n            ? (span[\"attributes\"] as Record<string, any>)\n            : {};\n\n        if (ATTR_GEN_AI_SYSTEM in attributes) {\n          const modelId = attributes[ATTR_GEN_AI_RESPONSE_MODEL] as string;\n          const { modelVendor, model } = this._extractVendorAndModel(modelId);\n\n          span.setAttribute(ATTR_GEN_AI_RESPONSE_MODEL, model);\n\n          if (!(result.body instanceof Object.getPrototypeOf(Uint8Array))) {\n            const rawRes = result.body as AsyncIterable<bedrock.ResponseStream>;\n\n            let streamedContent = \"\";\n            for await (const value of rawRes) {\n              // Convert it to a JSON String\n              const jsonString = new TextDecoder().decode(value.chunk?.bytes);\n              // Parse the JSON string\n              const parsedResponse = JSON.parse(jsonString);\n\n              if (\"amazon-bedrock-invocationMetrics\" in parsedResponse) {\n                span.setAttribute(\n                  ATTR_GEN_AI_USAGE_PROMPT_TOKENS,\n                  parsedResponse[\"amazon-bedrock-invocationMetrics\"][\n                    \"inputTokenCount\"\n                  ],\n                );\n                span.setAttribute(\n                  ATTR_GEN_AI_USAGE_COMPLETION_TOKENS,\n                  parsedResponse[\"amazon-bedrock-invocationMetrics\"][\n                    \"outputTokenCount\"\n                  ],\n                );\n\n                span.setAttribute(\n                  SpanAttributes.LLM_USAGE_TOTAL_TOKENS,\n                  parsedResponse[\"amazon-bedrock-invocationMetrics\"][\n                    \"inputTokenCount\"\n                  ] +\n                    parsedResponse[\"amazon-bedrock-invocationMetrics\"][\n                      \"outputTokenCount\"\n                    ],\n                );\n              }\n\n              let responseAttributes = this._setResponseAttributes(\n                modelVendor,\n                parsedResponse,\n                true,\n              );\n\n              // ! NOTE: This make sure the content always have all streamed chunks\n              if (this._shouldSendPrompts()) {\n                // Update local value with attribute value that was set by _setResponseAttributes\n                streamedContent +=\n                  responseAttributes[`${ATTR_GEN_AI_COMPLETION}.0.content`];\n                // re-assign the new value to responseAttributes\n                responseAttributes = {\n                  ...responseAttributes,\n                  [`${ATTR_GEN_AI_COMPLETION}.0.content`]: streamedContent,\n                };\n              }\n\n              span.setAttributes(responseAttributes);\n            }\n          } else if (result.body instanceof Object.getPrototypeOf(Uint8Array)) {\n            // Convert it to a JSON String\n            const jsonString = new TextDecoder().decode(\n              result.body as Uint8Array,\n            );\n            // Parse the JSON string\n            const parsedResponse = JSON.parse(jsonString);\n\n            const responseAttributes = this._setResponseAttributes(\n              modelVendor,\n              parsedResponse,\n            );\n\n            span.setAttributes(responseAttributes);\n          }\n        }\n      }\n    } catch (e) {\n      this._diag.debug(e);\n      this._config.exceptionLogger?.(e);\n    }\n\n    span.setStatus({ code: SpanStatusCode.OK });\n    span.end();\n  }\n\n  private _setRequestAttributes(\n    vendor: string,\n    requestBody: Record<string, any>,\n  ) {\n    switch (vendor) {\n      case \"ai21\": {\n        return {\n          [ATTR_GEN_AI_REQUEST_TOP_P]: requestBody[\"topP\"],\n          [ATTR_GEN_AI_REQUEST_TEMPERATURE]: requestBody[\"temperature\"],\n          [ATTR_GEN_AI_REQUEST_MAX_TOKENS]: requestBody[\"maxTokens\"],\n          [SpanAttributes.LLM_PRESENCE_PENALTY]:\n            requestBody[\"presencePenalty\"][\"scale\"],\n          [SpanAttributes.LLM_FREQUENCY_PENALTY]:\n            requestBody[\"frequencyPenalty\"][\"scale\"],\n\n          // Prompt & Role\n          ...(this._shouldSendPrompts()\n            ? {\n                [`${ATTR_GEN_AI_PROMPT}.0.role`]: \"user\",\n                [`${ATTR_GEN_AI_PROMPT}.0.content`]: requestBody[\"prompt\"],\n              }\n            : {}),\n        };\n      }\n      case \"amazon\": {\n        return {\n          [ATTR_GEN_AI_REQUEST_TOP_P]:\n            requestBody[\"textGenerationConfig\"][\"topP\"],\n          [ATTR_GEN_AI_REQUEST_TEMPERATURE]:\n            requestBody[\"textGenerationConfig\"][\"temperature\"],\n          [ATTR_GEN_AI_REQUEST_MAX_TOKENS]:\n            requestBody[\"textGenerationConfig\"][\"maxTokenCount\"],\n\n          // Prompt & Role\n          ...(this._shouldSendPrompts()\n            ? {\n                [`${ATTR_GEN_AI_PROMPT}.0.role`]: \"user\",\n                [`${ATTR_GEN_AI_PROMPT}.0.content`]: requestBody[\"inputText\"],\n              }\n            : {}),\n        };\n      }\n      case \"anthropic\": {\n        const baseAttributes = {\n          [ATTR_GEN_AI_REQUEST_TOP_P]: requestBody[\"top_p\"],\n          [SpanAttributes.LLM_TOP_K]: requestBody[\"top_k\"],\n          [ATTR_GEN_AI_REQUEST_TEMPERATURE]: requestBody[\"temperature\"],\n          [ATTR_GEN_AI_REQUEST_MAX_TOKENS]:\n            requestBody[\"max_tokens_to_sample\"] || requestBody[\"max_tokens\"],\n        };\n\n        if (!this._shouldSendPrompts()) {\n          return baseAttributes;\n        }\n\n        // Handle new messages API format (used by langchain)\n        if (requestBody[\"messages\"]) {\n          const promptAttributes: Record<string, any> = {};\n          requestBody[\"messages\"].forEach((message: any, index: number) => {\n            promptAttributes[`${ATTR_GEN_AI_PROMPT}.${index}.role`] =\n              message.role;\n            promptAttributes[`${ATTR_GEN_AI_PROMPT}.${index}.content`] =\n              typeof message.content === \"string\"\n                ? message.content\n                : JSON.stringify(message.content);\n          });\n          return { ...baseAttributes, ...promptAttributes };\n        }\n\n        // Handle legacy prompt format\n        if (requestBody[\"prompt\"]) {\n          return {\n            ...baseAttributes,\n            [`${ATTR_GEN_AI_PROMPT}.0.role`]: \"user\",\n            [`${ATTR_GEN_AI_PROMPT}.0.content`]: requestBody[\"prompt\"]\n              // The format is removing when we are setting span attribute\n              .replace(\"\\n\\nHuman:\", \"\")\n              .replace(\"\\n\\nAssistant:\", \"\"),\n          };\n        }\n\n        return baseAttributes;\n      }\n      case \"cohere\": {\n        return {\n          [ATTR_GEN_AI_REQUEST_TOP_P]: requestBody[\"p\"],\n          [SpanAttributes.LLM_TOP_K]: requestBody[\"k\"],\n          [ATTR_GEN_AI_REQUEST_TEMPERATURE]: requestBody[\"temperature\"],\n          [ATTR_GEN_AI_REQUEST_MAX_TOKENS]: requestBody[\"max_tokens\"],\n\n          // Prompt & Role\n          ...(this._shouldSendPrompts()\n            ? {\n                [`${ATTR_GEN_AI_PROMPT}.0.role`]: \"user\",\n                [`${ATTR_GEN_AI_PROMPT}.0.content`]:\n                  requestBody[\"message\"] || requestBody[\"prompt\"],\n              }\n            : {}),\n        };\n      }\n      case \"meta\": {\n        return {\n          [ATTR_GEN_AI_REQUEST_TOP_P]: requestBody[\"top_p\"],\n          [ATTR_GEN_AI_REQUEST_TEMPERATURE]: requestBody[\"temperature\"],\n          [ATTR_GEN_AI_REQUEST_MAX_TOKENS]: requestBody[\"max_gen_len\"],\n\n          // Prompt & Role\n          ...(this._shouldSendPrompts()\n            ? {\n                [`${ATTR_GEN_AI_PROMPT}.0.role`]: \"user\",\n                [`${ATTR_GEN_AI_PROMPT}.0.content`]: requestBody[\"prompt\"],\n              }\n            : {}),\n        };\n      }\n      default:\n        return {};\n    }\n  }\n\n  private _setResponseAttributes(\n    vendor: string,\n    response: Record<string, any>,\n    isStream = false,\n  ) {\n    switch (vendor) {\n      case \"ai21\": {\n        return {\n          [`${ATTR_GEN_AI_COMPLETION}.0.finish_reason`]:\n            response[\"completions\"][0][\"finishReason\"][\"reason\"],\n          [`${ATTR_GEN_AI_COMPLETION}.0.role`]: \"assistant\",\n          ...(this._shouldSendPrompts()\n            ? {\n                [`${ATTR_GEN_AI_COMPLETION}.0.content`]:\n                  response[\"completions\"][0][\"data\"][\"text\"],\n              }\n            : {}),\n        };\n      }\n      case \"amazon\": {\n        return {\n          [`${ATTR_GEN_AI_COMPLETION}.0.finish_reason`]: isStream\n            ? response[\"completionReason\"]\n            : response[\"results\"][0][\"completionReason\"],\n          [`${ATTR_GEN_AI_COMPLETION}.0.role`]: \"assistant\",\n          [ATTR_GEN_AI_USAGE_PROMPT_TOKENS]: response[\"inputTextTokenCount\"],\n          [ATTR_GEN_AI_USAGE_COMPLETION_TOKENS]: isStream\n            ? response[\"totalOutputTextTokenCount\"]\n            : response[\"results\"][0][\"tokenCount\"],\n          [SpanAttributes.LLM_USAGE_TOTAL_TOKENS]: isStream\n            ? response[\"inputTextTokenCount\"] +\n              response[\"totalOutputTextTokenCount\"]\n            : response[\"inputTextTokenCount\"] +\n              response[\"results\"][0][\"tokenCount\"],\n          ...(this._shouldSendPrompts()\n            ? {\n                [`${ATTR_GEN_AI_COMPLETION}.0.content`]: isStream\n                  ? response[\"outputText\"]\n                  : response[\"results\"][0][\"outputText\"],\n              }\n            : {}),\n        };\n      }\n      case \"anthropic\": {\n        const baseAttributes = {\n          [`${ATTR_GEN_AI_COMPLETION}.0.finish_reason`]:\n            response[\"stop_reason\"],\n          [`${ATTR_GEN_AI_COMPLETION}.0.role`]: \"assistant\",\n        };\n\n        if (!this._shouldSendPrompts()) {\n          return baseAttributes;\n        }\n\n        // Handle new messages API format response\n        if (response[\"content\"]) {\n          const content = Array.isArray(response[\"content\"])\n            ? response[\"content\"].map((c: any) => c.text || c).join(\"\")\n            : response[\"content\"];\n          return {\n            ...baseAttributes,\n            [`${ATTR_GEN_AI_COMPLETION}.0.content`]: content,\n          };\n        }\n\n        // Handle legacy completion format\n        if (response[\"completion\"]) {\n          return {\n            ...baseAttributes,\n            [`${ATTR_GEN_AI_COMPLETION}.0.content`]: response[\"completion\"],\n          };\n        }\n\n        return baseAttributes;\n      }\n      case \"cohere\": {\n        const baseAttributes = {\n          [`${ATTR_GEN_AI_COMPLETION}.0.finish_reason`]:\n            response[\"generations\"]?.[0]?.[\"finish_reason\"],\n          [`${ATTR_GEN_AI_COMPLETION}.0.role`]: \"assistant\",\n          ...(this._shouldSendPrompts()\n            ? {\n                [`${ATTR_GEN_AI_COMPLETION}.0.content`]:\n                  response[\"generations\"]?.[0]?.[\"text\"],\n              }\n            : {}),\n        };\n\n        // Add token usage if available\n        if (response[\"meta\"] && response[\"meta\"][\"billed_units\"]) {\n          const billedUnits = response[\"meta\"][\"billed_units\"];\n          return {\n            ...baseAttributes,\n            [ATTR_GEN_AI_USAGE_PROMPT_TOKENS]: billedUnits[\"input_tokens\"],\n            [ATTR_GEN_AI_USAGE_COMPLETION_TOKENS]: billedUnits[\"output_tokens\"],\n            [SpanAttributes.LLM_USAGE_TOTAL_TOKENS]:\n              (billedUnits[\"input_tokens\"] || 0) +\n              (billedUnits[\"output_tokens\"] || 0),\n          };\n        }\n\n        return baseAttributes;\n      }\n      case \"meta\": {\n        return {\n          [`${ATTR_GEN_AI_COMPLETION}.0.finish_reason`]:\n            response[\"stop_reason\"],\n          [`${ATTR_GEN_AI_COMPLETION}.0.role`]: \"assistant\",\n          [ATTR_GEN_AI_USAGE_PROMPT_TOKENS]: response[\"prompt_token_count\"],\n          [ATTR_GEN_AI_USAGE_COMPLETION_TOKENS]:\n            response[\"generation_token_count\"],\n          [SpanAttributes.LLM_USAGE_TOTAL_TOKENS]:\n            response[\"prompt_token_count\"] + response[\"generation_token_count\"],\n          ...(this._shouldSendPrompts()\n            ? {\n                [`${ATTR_GEN_AI_COMPLETION}.0.content`]: response[\"generation\"],\n              }\n            : {}),\n        };\n      }\n      default:\n        return {};\n    }\n  }\n\n  private _shouldSendPrompts() {\n    const contextShouldSendPrompts = context\n      .active()\n      .getValue(CONTEXT_KEY_ALLOW_TRACE_CONTENT);\n\n    if (contextShouldSendPrompts !== undefined) {\n      return contextShouldSendPrompts;\n    }\n\n    return this._config.traceContent !== undefined\n      ? this._config.traceContent\n      : true;\n  }\n\n  private _extractVendorAndModel(modelId: string): {\n    modelVendor: string;\n    model: string;\n  } {\n    if (!modelId) {\n      return { modelVendor: \"\", model: \"\" };\n    }\n\n    const parts = modelId.split(\".\");\n    return {\n      modelVendor: parts[0] || \"\",\n      model: parts[1] || \"\",\n    };\n  }\n}\n"],"names":["InstrumentationBase","InstrumentationNodeModuleDefinition","trace","context","safeExecuteInTheMiddle","__awaiter","SpanStatusCode","ATTR_GEN_AI_SYSTEM","ATTR_GEN_AI_REQUEST_MODEL","ATTR_GEN_AI_RESPONSE_MODEL","SpanAttributes","LLMRequestTypeValues","SpanKind","__asyncValues","ATTR_GEN_AI_USAGE_PROMPT_TOKENS","ATTR_GEN_AI_USAGE_COMPLETION_TOKENS","ATTR_GEN_AI_COMPLETION","ATTR_GEN_AI_REQUEST_TOP_P","ATTR_GEN_AI_REQUEST_TEMPERATURE","ATTR_GEN_AI_REQUEST_MAX_TOKENS","ATTR_GEN_AI_PROMPT","CONTEXT_KEY_ALLOW_TRACE_CONTENT"],"mappings":"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"}