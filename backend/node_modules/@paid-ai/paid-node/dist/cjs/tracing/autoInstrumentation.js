"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.paidAutoInstrument = paidAutoInstrument;
const instrumentation_1 = require("@opentelemetry/instrumentation");
const openinference_instrumentation_openai_1 = require("@arizeai/openinference-instrumentation-openai");
const instrumentation_bedrock_1 = require("@traceloop/instrumentation-bedrock");
const openinference_instrumentation_anthropic_1 = require("@arizeai/openinference-instrumentation-anthropic");
const tracing_1 = require("./tracing");
let IS_INITIALIZED = false;
const getInstrumentations = (tracerProvider) => {
    const instrumentations = [
        new openinference_instrumentation_openai_1.OpenAIInstrumentation({ tracerProvider }),
        new openinference_instrumentation_anthropic_1.AnthropicInstrumentation({ tracerProvider }),
        new instrumentation_bedrock_1.BedrockInstrumentation(),
    ];
    return instrumentations;
};
const getManualInstrumentations = (tracerProvider, libraries) => {
    const instrumentations = [];
    if (libraries.openai) {
        const openaiInstrumentation = new openinference_instrumentation_openai_1.OpenAIInstrumentation({ tracerProvider });
        instrumentations.push(openaiInstrumentation);
        openaiInstrumentation.manuallyInstrument(libraries.openai);
    }
    if (libraries.anthropic) {
        const anthropicInstrumentation = new openinference_instrumentation_anthropic_1.AnthropicInstrumentation({ tracerProvider });
        instrumentations.push(anthropicInstrumentation);
        anthropicInstrumentation.manuallyInstrument(libraries.anthropic);
    }
    if (libraries.bedrock) {
        const bedrockInstrumentation = new instrumentation_bedrock_1.BedrockInstrumentation();
        instrumentations.push(bedrockInstrumentation);
        bedrockInstrumentation.manuallyInstrument(libraries.bedrock);
    }
    return instrumentations;
};
function paidAutoInstrument(libraries) {
    if (IS_INITIALIZED) {
        tracing_1.logger.info("Auto instrumentation is already initialized");
        return;
    }
    (0, tracing_1.initializeTracing)(); // try initializing tracing
    const tracerProvider = (0, tracing_1.getPaidTracerProvider)();
    if (!tracerProvider) {
        tracing_1.logger.error("Could not get tracer provider, make sure you ran 'initializeTracing()' or check your environment variables");
        return;
    }
    const isManualInstrumentation = libraries && Object.keys(libraries).length > 0;
    const instrumentations = isManualInstrumentation
        ? getManualInstrumentations(tracerProvider, libraries)
        : getInstrumentations(tracerProvider);
    (0, instrumentation_1.registerInstrumentations)({
        instrumentations,
        tracerProvider,
    });
    IS_INITIALIZED = true;
}
